# 用語集

このドキュメントでは、プログラム実装スキルで使用される主要な用語を定義します。

---

## TDD関連の用語

### 段階（Stage）
TDDサイクルの各フェーズを指します。

- **Red段階**: 失敗するテストを書く段階
- **Green段階**: テストを通す最小限のコードを書く段階
- **Refactor段階**: コードを改善する段階

**使用例**: "Green段階では重複コードが許容されます"

---

### ステップ（Step）
実装手順の各工程を指します。

**使用例**:
- "ステップ0: テスティングフレームワークの選定"
- "ステップ1: 要件を理解する"
- "ステップ2: テストケースをリストアップ"

---

### フェーズ（Phase）
開発の大きな段階や段階的な進化を指します。

**使用例**:
- "フェーズ1: 最小限の実装"
- "フェーズ2: 機能追加"
- "フェーズ3: パフォーマンス最適化"

---

## コードの種類

### ビジネスロジック
ドメイン固有のルールや知識を表現するコード。

**例**:
- 消費税率の計算（税率10%）
- パスワードの最小文字数（8文字以上）
- 注文キャンセル可能期間（24時間以内）

**判断基準**:
- ✅ **ビジネス要件書やドメイン専門家から提供される仕様に基づくもの**
- ✅ **変更時にステークホルダーの承認が必要になるもの**
- ✅ **ドメイン用語を使って表現されるもの**
  - 例: 「プレミアム会員」「キャンセル期限」「割引率」

- ❌ **技術的な詳細**（ビジネスロジックではない）
  - 例: HTTPステータスコード、ファイルパス、ログレベル
  - データベース接続タイムアウト、キャッシュTTL

**特徴**: 変更時に修正漏れがあると重大な問題になる

---

### 本質的な重複
同じビジネスルールや知識が複数箇所で表現されている状態。

**例**:
```typescript
// 複数箇所で同じ税率が使われている
const orderTotal = subtotal * 1.1;  // 10%の税率
const invoiceTotal = amount * 1.1;  // 同じ10%の税率
```

**対応**: DRY原則に従い、共通化すべき

---

### 偶然の重複
コードは似ているが、意味やドメインが異なる重複。

**例**:
```typescript
// 注文の合計金額
function calculateOrderTotal(items: OrderItem[]): number {
  return items.reduce((sum, item) => sum + item.price * item.quantity, 0);
}

// 在庫の評価額（たまたま似ているだけ）
function calculateInventoryValue(products: Product[]): number {
  return products.reduce((sum, p) => sum + p.cost * p.stock, 0);
}
```

**対応**: KISS原則に従い、無理に共通化しない

---

## 設計原則

### DRY原則（Don't Repeat Yourself）
同じことを繰り返さない原則。重複コードを排除し、知識を一箇所に集約する。

**詳細**: [DRY原則](dont-repeat-yourself.md)

---

### KISS原則（Keep It Simple, Stupid）
シンプルさを保つ原則。不必要な複雑さを導入しない。

**詳細**: [KISS原則](kiss.md)

---

### YAGNI原則（You Aren't Gonna Need It）
今必要でない機能は実装しない原則。将来の予測に基づいた実装を避ける。

**詳細**: [YAGNI原則](yagni.md)

---

### SOLID原則
オブジェクト指向設計の5つの原則の頭文字。

- **S**: Single Responsibility Principle（単一責任の原則）
- **O**: Open/Closed Principle（開放閉鎖の原則）
- **L**: Liskov Substitution Principle（リスコフの置換原則）
- **I**: Interface Segregation Principle（インターフェース分離の原則）
- **D**: Dependency Inversion Principle（依存性逆転の原則）

**詳細**: [SOLID原則](solid.md)

---

### デメテルの法則（Law of Demeter）
オブジェクトは直接の友人とだけ話すべきという原則。別名「最小知識の原則」。

**簡略ルール**: ドットは1つまで

**詳細**: [デメテルの法則](law-of-demeter.md)

---

### コンポジション優先原則（Composition over Inheritance）
継承よりもコンポジションを優先すべきという原則。

**詳細**: [コンポジション優先原則](composition-over-inheritance.md)

---

## その他の用語

### 3回ルール（Rule of Three）
同じコードが3回出現したら共通化を検討するという経験則。

**カウント方法**:
- **一般的なコード**: 同じコードブロック（5行以上）が3回出現 → 共通化を検討
  - 同じファイル内で3回でも、異なるファイルで合計3回でもOK
  - 2回程度なら様子見
- **ビジネスロジック/設定値**: 2回でも共通化を検討
  - 税率、最小文字数、有効期限などのビジネスルール
  - マジックナンバーやマジックストリング
  - 修正漏れのリスクが高いため、3回を待たずに共通化
- **1-2行の短いコード**: 文脈に応じて判断
  - 単純な`return true;`などは除外
  - ビジネスルールを含む場合（例: `return amount * 1.1;`）は共通化を検討

**適用タイミング**: Refactor段階

**関連**: [DRY vs KISS判断ガイド](dry-vs-kiss-decision-guide.md)を参照

---

### マジックナンバー
意味が不明な数値や文字列のハードコーディング。

**悪い例**:
```typescript
if (user.age > 18) { /* ... */ }  // 18の意味が不明
```

**良い例**:
```typescript
const LEGAL_AGE = 18;
if (user.age > LEGAL_AGE) { /* ... */ }
```

---

### デッドコード
どこからも呼び出されていない、使われていないコード。

**対応**: YAGNI原則に従い、削除する

---

### リファクタリング（Refactoring）
外部の振る舞いを変えずに、内部構造を改善すること。

**TDDとの関係**: Refactor段階で実行。テストがあるため安全に実施可能。

---

### モック（Mock）
テスト時に実際のオブジェクトの代わりに使用する模擬オブジェクト。

**使用例**:
```typescript
const mockDatabase = {
  query: jest.fn().mockResolvedValue([/* データ */])
};
```

---

### スタブ（Stub）
テスト時に固定の値を返す簡易的な実装。

---

### カプセル化（Encapsulation）
オブジェクトの内部実装を隠蔽し、外部からは必要な操作のみ提供すること。

**関連**: デメテルの法則はカプセル化を強化する

---

### 結合度（Coupling）
モジュール間の依存関係の強さ。

- **低い結合度（疎結合）**: 独立性が高く、変更の影響が少ない（推奨）
- **高い結合度（密結合）**: 依存が強く、変更の影響が大きい（避けるべき）

---

### 凝集度（Cohesion）
モジュール内の要素がどれだけ関連しているかの度合い。

- **高い凝集度**: 関連性の高い機能がまとまっている（推奨）
- **低い凝集度**: 無関係な機能が混在している（避けるべき）

---

### is-a 関係
「AはBである」という継承関係。

**例**: Dog is an Animal（犬は動物である）

---

### has-a 関係
「AはBを持つ」というコンポジション関係。

**例**: Car has an Engine（車はエンジンを持つ）

---

### Tell, Don't Ask
オブジェクトに尋ねるのではなく、命令するべきという原則。

**悪い例（Ask）**:
```typescript
if (user.getWallet().getBalance() > 100) {
  user.getWallet().deduct(100);
}
```

**良い例（Tell）**:
```typescript
user.purchase(100);
```

**関連**: デメテルの法則と密接に関連

---

## まとめ

これらの用語を理解することで、本スキルドキュメント全体の理解が深まります。

各用語の詳細については、リンク先のドキュメントを参照してください。
