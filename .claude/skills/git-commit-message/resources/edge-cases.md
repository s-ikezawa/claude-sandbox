# エッジケースと特殊な状況

このドキュメントでは、特殊な状況やエッジケースに遭遇した場合の対処方法を説明します。

**用語の定義**: このドキュメントでは、以下の用語を使用します。詳細は [SKILL.md](../SKILL.md) を参照してください。
- **開発者**: このスキルを使用してコミットメッセージを生成する人（AIが対話する相手）
- **ユーザー**: ソフトウェアのエンドユーザー（開発者が作成するアプリケーションを使用する人）

## 変更がない場合

`git status`の結果、変更がない（コミットできる内容がない）場合：

### 対応手順
1. **開発者に通知する**：
   ```text
   変更がないためコミットできません。

   git statusの結果：
   On branch main
   nothing to commit, working tree clean
   ```

2. **次のアクションを提案する**：
   - ファイルの編集を行う
   - `git add`でファイルをステージングする
   - 既にステージング済みの変更があるか確認する

3. **原因の可能性を示す**：
   - すべての変更が既にコミット済み
   - ファイルがステージングされていない（`git add`が必要）
   - `.gitignore`で除外されている

## 初回コミット

リポジトリの最初のコミット（推奨順）：

### 1. プロジェクト初期セットアップの場合（推奨）
プロジェクトの構造、設定ファイル、依存関係などを含む本格的なセットアップを行った場合：

```text
feat: プロジェクト初期セットアップ
```

**判断基準** - 以下のいずれかを含む場合は「プロジェクト初期セットアップ」：
- package.json、requirements.txt、go.mod等の依存関係ファイル
- ソースコードディレクトリ構造（src/, lib/, tests/等）
- 設定ファイル（tsconfig.json, .eslintrc, webpack.config.js等）
- ビルドシステムやCI設定ファイル

### 2. 最小限のコミットの場合
READMEやライセンスファイルのみなど、最小限の内容でコミットする場合：

```text
chore: 初回コミット
```

**判断基準** - 以下のファイルのみの場合は「初回コミット」：
- READMEのみ
- LICENSEのみ
- .gitignoreのみ
- これらの組み合わせ（ドキュメント・設定ファイルのみ）

## セキュリティ上問題のあるファイルが検出された場合

フェーズ1のセキュリティチェックで機密情報ファイルが検出された場合：

### 対応手順
1. **開発者に警告する**：
   ```text
   ⚠️ セキュリティ警告：機密情報を含む可能性のあるファイルが検出されました。

   検出されたファイル：
   - .env
   - config/secrets.yaml

   これらのファイルをコミットすると、機密情報が公開される危険性があります。
   ```

2. **`.gitignore`への追加を提案する**（適切な場合）：
   ```text
   これらのファイルを.gitignoreに追加することを推奨します。

   以下の内容を.gitignoreに追加できます：
   .env
   config/secrets.*

   .gitignoreに追加しますか？
   ```

3. **開発者の選択に応じて処理**：
   - **「.gitignoreに追加する」**: `.gitignore`ファイルを編集し、該当パターンを追加
   - **「コミットしない」**: 処理を中止
   - **「それでもコミットする」**: 再度確認し、開発者が明示的に承認した場合のみコミットを実行

### 重要な注意事項
- AIは独自判断でコミットを実行してはならない
- 開発者が「それでもコミットする」と明示した場合でも、最終確認を行う
- コミット後に機密情報を削除しても、Gitの履歴には残ることを開発者に警告する

## WIPコミット

開発途中の作業を一時的にコミットする場合：

### 対応手順

**判断基準** - 以下の場合のみWIPコミットを作成する：
1. **開発者が明示的にWIPコミットを依頼した場合**
   - 例：「WIPでコミットして」「作業中だけどコミットして」
2. **開発者が「とりあえずコミット」「一時的にコミット」などと指示した場合**

上記以外の場合は、**常に適切なConventional Commitsメッセージを作成する**。
AIが以下の理由で独自判断でWIPコミットを作成してはならない：
- 「テストがまだ書かれていない」
- 「ドキュメントが未完成」
- 「TODOコメントが残っている」
- 「コードが動作するか未確認」

これらは開発者の判断事項であり、AIが決定すべきではない。

### WIPコミットの作成方法
開発者がWIPコミットを明示的に依頼した場合、以下のいずれかの方法を使用する：

1. **Conventional Commitsに準拠（推奨）**: 適切なタイプを使用し、説明文に「WIP」を含める
   ```text
   feat(auth): WIP - OAuth認証フローを実装中
   fix(parser): WIP - nullエラーをデバッグ中
   ```

2. **非標準のwipタイプを使用**:
   ```text
   wip: 新しいアルゴリズムを実験中
   ```
   - ⚠️ **注意**: `wip` は公式のConventional Commitsタイプではない
   - 本番ブランチにマージする前に適切なコミットメッセージに書き換える必要がある
   - 書き換えには `git commit --amend` またはGitの履歴編集機能を使用する

### 重要な注意事項
- WIPコミットは一時的なものであり、最終的にはConventional Commitsに準拠したコミットに整理すべき
- プロジェクトの慣習を確認する（一部のプロジェクトではWIPコミットを禁止している）
- 可能であれば、意味のある単位で完成させてから通常のコミットを作成することを推奨
- **このスキルではGitの履歴編集操作（rebase等）は扱わない** - 必要な場合は開発者自身で実施する

## マージコミット

マージコミットは通常、Gitが自動生成するメッセージをそのまま使用する：

```text
Merge branch 'feature/user-auth' into main
```

ただし、コンフリクト解決が複雑な場合は、本文に日本語で説明を追加することを推奨する。

## 自動生成コミット

Dependabot、Renovate、その他の自動化ツールによるコミット：

- タイプの選択は [type-selection-guide.md - ケース6：依存関係の更新](type-selection-guide.md#ケース6依存関係dependenciesの更新) を参照
- ツールが生成するメッセージをそのまま使用してもよい（その場合、英語でも可）

## 巨大な変更の扱い

大規模なリファクタリングやマイグレーションの場合：

1. **推奨**: 複数の小さなコミットに分割する
2. **不可能な場合**: 本文に詳細な説明を記載する

### 判断の目安

以下のような場合、「巨大な変更」と判断する：
- 変更されたファイルが20個以上
- 追加・削除された行数が合計500行以上
- 複数のディレクトリやモジュールにまたがる広範な変更

### git statusの例

```text
modified:   src/services/userService.js -> src/services/userService.ts
modified:   src/services/authService.js -> src/services/authService.ts
modified:   src/utils/validator.js -> src/utils/validator.ts
... (50個以上のファイル)
new file:   tsconfig.json
modified:   package.json
modified:   webpack.config.js
```

### git diffの概要

```text
 50 files changed, 1247 insertions(+), 983 deletions(-)
 rename src/services/{userService.js => userService.ts} (95%)
 rename src/services/{authService.js => authService.ts} (92%)
 ...
```

3. **コミットメッセージの例**:
```text
refactor!: JavaScriptからTypeScriptに移行

全てのソースファイルをTypeScriptに変換した。
主な変更点：
- .js ファイルを .ts に変換
- 型定義を追加
- tsconfig.json を追加
- ビルドプロセスを更新

BREAKING CHANGE: Node.js 14以上が必要になった
```

## 複数の著者によるコミット

ペアプログラミングや共同作業の場合、フッターに共著者を記載する：

```text
feat: 協調編集機能を実装

複数ユーザーが同時に編集できる機能を実装した。

Co-authored-by: 田中太郎 <tanaka@example.com>
Co-authored-by: 佐藤花子 <sato@example.com>
```

## 空のコミット

CIを再実行するために空のコミットが必要な場合：

```bash
git commit --allow-empty -m "chore: CI再実行をトリガー"
```

## ブランチ命名との整合性

ブランチ名とコミットメッセージは一貫性を保つことを推奨する：

- ブランチ: `feature/user-authentication`
- コミット: `feat(auth): ユーザー認証機能を追加`

## コミットの取り消し（revert）

以前のコミットを取り消す必要がある場合：

- **推奨**: `revert`タイプを使用し、元に戻されるコミットのSHAをフッターに記載する
- **例**:
```text
revert: 実験的機能を削除

この機能は本番環境で問題を引き起こしたため取り消す。

Refs: 676104e, a215868
```

複数のコミットを取り消す場合や、機能全体を取り消す場合は、取り消す範囲を本文に明記することを推奨する。
